<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Trashcam</title>

  <!-- Bootstrap core CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="sidebar.css" rel="stylesheet">

</head>

<body>

  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
      <div class="sidebar-heading">Trashcam</div>
      <div class="list-group list-group-flush">
        <a href="#" class="list-group-item list-group-item-action bg-light">Dashboard</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Shortcuts</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Overview</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Events</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Profile</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Status</a>
      </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">

        <button class="navbar-toggler" type="button" id="menu-toggle">
          Fallback<span class="navbar-toggler-icon"></span>
        </button>
      </nav>

      <div class="container-fluid">
        <video id="video" width="640" height="480" autoplay></video>
        <canvas id="canvas" width="640" height="480"></canvas>


        <script>
          var video = document.getElementById('video');
        
          // Get access to the camera!
          if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
              // Not adding `{ audio: true }` since we only want video now
              navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
                  //video.src = window.URL.createObjectURL(stream);
                  video.srcObject = stream;
                  video.play();
              });
          }
        </script> 

        <div>Teachable Machine Image Model</div>
          <button type="button" onclick="init()">Start</button>
          <button type="button" onclick="predict()">Predict</button>
            <div id="webcam-container"></div>
              <div id="label-container"></div>

                <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
                <script type="text/javascript">
                  // More API functions here:
                  // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image
                              
                  // the link to your model provided by Teachable Machine export panel
                  const URL = "https://teachablemachine.withgoogle.com/models/LXfkCId8/";
                              
                  let model, webcam, labelContainer, maxPredictions;
                              
                  // Load the image model and setup the webcam
                  async function init() {
                      const modelURL = URL + "model.json";
                      const metadataURL = URL + "metadata.json";
                  
                      // load the model and metadata
                      // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
                      // or files from your local hard drive
                      // Note: the pose library adds "tmImage" object to your window (window.tmImage)
                      model = await tmImage.load(modelURL, metadataURL);
                      maxPredictions = model.getTotalClasses();
                  
                      labelContainer = document.getElementById("label-container");
                      for (let i = 0; i < maxPredictions; i++) { // and class labels
                          labelContainer.appendChild(document.createElement("div"));
                      }
                  }
                
                  // run the webcam image through the image model
                  async function predict() {
                    var video = document.getElementById('video');
                      // predict can take in an image, video or canvas html element
                      const prediction = await model.predict(video);
                      for (let i = 0; i < maxPredictions; i++) {
                          const classPrediction =
                              prediction[i].className + ": " + prediction[i].probability.toFixed(2);
                          labelContainer.childNodes[i].innerHTML = classPrediction;
                      }
                  }
                </script>
              </div>
            </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Bootstrap core JavaScript -->
  <script
			  src="https://code.jquery.com/jquery-3.4.1.js"
			  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
			  crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
  

  <!-- Menu Toggle Script -->
  <script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
  </script>

</body>

</html>